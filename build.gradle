apply plugin: 'java'
apply plugin: 'scala'

version = '1.0'

String Home = System.getenv("HOME")
String DseHome = System.getenv("DSE_HOME") ?: "$Home/dse"
String DseResources = System.getenv("DSE_RESOURCES") ?: "$Home/dse/resources/"
String mainClassName = "SparkCassandraStress"

jar {
    manifest.attributes("Main-Class": mainClassName)
    baseName = "SparkCassandraStress"
    from {
        (configurations.runtime - configurations.provided).collect {
            it.isDirectory() ? it : zipTree(it)
        }
    }
}

tasks.withType(Exec) {
    environment  "DSE_HOME": DseHome
}

task run_dse(type:Exec) {
    commandLine "$DseHome/bin/dse", "spark-submit", "--class", mainClassName, jar.archivePath
}
run_dse.dependsOn jar

task run_apache(type:Exec) {

}


configurations {
    provided
    compile.extendsFrom provided
}

ext {
    scalaVersion = '2.10.4'
}

repositories {
    mavenCentral()
}

dependencies {
    compile "com.github.scopt:scopt_2.10:3.2.0"


    [
            'dse/lib',
            'driver/lib',
            'cassandra/lib',
            'spark/lib',
            'shark/lib',
            'hadoop',
            'hadoop/lib',
    ].each {dir ->
        provided fileTree(dir: "$DseResources/$dir", include: '*.jar')
    }
    provided fileTree(dir: "$DseHome/lib", include: '*.jar')
}
